<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Data Intelligence</title>
    <style>
        body {
            font-family: "Segoe UI", sans-serif;
            font-size: 100%;
            margin: 0;
            padding: 0;
            height: 100%;
        }

        .sidebar {
            position: fixed;
            height: 100%;
            width: 0;
            top: 0;
            left: 0;
            z-index: 1;
            background-color: #005580;
            overflow-x: hidden;
            transition: 0.4s;
            padding: 2rem 0;
            box-sizing: border-box;
        }

            .sidebar .boton-cerrar {
                position: absolute;
                top: 0.5rem;
                right: 1rem;
                font-size: 2rem;
                display: block;
                padding: 0;
                line-height: 1.5rem;
                margin: 0;
                height: 32px;
                width: 32px;
                text-align: center;
                vertical-align: top;
            }

            .sidebar ul, .sidebar li {
                margin: 0;
                padding: 0;
                list-style: none inside;
            }

            .sidebar ul {
                margin-top: 0.1rem;
                margin-left: 4%;
                display: block;
                width: 92%;
                min-width: 20%;
            }

            .sidebar a {
                display: block;
                color: #eee;
                text-decoration: none;
            }

            .sidebar li {
                font-size: 13px;
                width: 100%;
            }

            .sidebar a:hover {
                color: #fff;
                background-color: #003048;
                border-radius: 5px;
            }

        #contenido {
            transition: margin-left .4s;
        }

        .abrir-cerrar {
            color: #2E88C7;
            font-size: 1rem;
            z-index: 999;
            margin-left: 2%;
            padding: 5px 10px 5px 10px;
            background-color: #f25e46;
            color: #FFF;
            text-decoration: none;
            border-radius: 4px;
            position: absolute;
            top: 90%;
        }

        #cerrar {
            display: none;
        }

        #map {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: -999;
        }

        .legend {
            background: rgba(255, 255, 255, 0.85);
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid #A9A9A9;
            box-shadow: 13px 10px 30px -3px rgba(0,0,0,0.47);
            -webkit-box-shadow: 13px 10px 30px -3px rgba(0,0,0,0.47);
            -moz-box-shadow: 13px 10px 30px -3px rgba(0,0,0,0.47);
        }


        .desc {
            margin-right: 5%;
            border: 1px solid #909090;
        }

        nav a {
            text-decoration: none;
            color: inherit;
            font-size: 14px;
        }

        nav li {
            display: inline-block;
            color: #fff;
        }


            nav li > ul {
                display: none !important;
            }

            nav li:hover > ul {
                display: block !important;
                margin-left: 10%;
            }

        .banner {
            width: 80%;
            height: auto;
        }

        .leaflet-popup-content {
            max-width: 220px;
            height: auto;
        }

        .legend {
            background: rgba(255, 255, 255, 0.85);
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid #A9A9A9;
            box-shadow: 13px 10px 30px -3px rgba(0,0,0,0.47);
            -webkit-box-shadow: 13px 10px 30px -3px rgba(0,0,0,0.47);
            -moz-box-shadow: 13px 10px 30px -3px rgba(0,0,0,0.47);
        }

        .desc {
            margin-right: 5%;
            border: 1px solid #909090;
        }

        #menu {
            font-family: Arial;
            font-size: 12.5px;
            text-align: center;
            z-index: 998;
            position: fixed;
            width: 100%;
            margin-top: 46em;
        }

            #menu ul li {
                display: inline-block;
                text-decoration: none;
                color: #FFF;
                padding: 0.6%;
                cursor: pointer;
                background-color: #005580;
                opacity: 1;
                width: 8%;
                border-radius: 5px;
                cursor: pointer;
            }

                #menu ul li:hover {
                    background-color: #004365;
                    cursor: pointer;
                }

        .logo {
            position: absolute;
            top: 92%;
            width: 75%;
            height: auto;
            margin-left: 10%;
        }

        .container {
            width: 100%;
            max-width: 600px;
        }

        button.accordion {
            background-color: #005580 !important;
            width: 100%;
            border: none;
            outline: none;
            text-align: left;
            padding: 5px 20px;
            font-size: 13.2px;
            color: #FFF;
            cursor: pointer;
            transition: background-color 0.2s linear;
        }

            button.accordion:after {
                content: '+';
                font-family: "fontawesome";
                font-size: 13px;
                float: right;
            }

            button.accordion.is-open:after {
                content: '-';
            }

            button.accordion:hover, button.accordion.is-open {
                background-color: #fff;
            }

        .accordion-content {
            padding: 0 20px;
            max-height: 0;
            overflow: hidden;
            color: #FFF;
            transition: max-height 0.2s ease-in-out;
        }

        #general {
            width: 100%;
            color: #FFF;
            margin-left: 8%;
            font-size: 14px;
        }

        #general {
            width: 100%;
            color: #FFF;
            margin-left: 8%;
            font-size: 14px;
        }

        #filtros {
            width: 100%;
            color: #FFF;
            margin-left: 8%;
            font-size: 12px;
            text-decoration: underline;
            margin-bottom: 5%;
            cursor: pointer;
        }

            #filtros:hover {
                color: #dfdfdf;
            }
    </style>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script>

        $(document).ready(function() {

            $('#abrir').on('click', function(){
                $('#map').css ("width", "82%");
                $('#menu').css ("width", "82%");
                $('#map').css ("transition", "0.4s");
                $('.op1').css ("width", "11%");
                $('.op2').css ("width", "11%");
                $('.op3').css ("width", "11%");
                map.fitBounds(comunaLimite.getBounds());
            });

            $('#cerrar').on('click', function(){
                $('#map').css ("width", "100%");
                $('#menu').css ("width", "100%");
                $('#map').css ("transition", "0.4s");
                map.fitBounds(comunaLimite.getBounds());
            });

            $('.boton-cerrar').on('click', function(){
                $('#map').css ("width", "100%");
                $('#menu').css ("width", "100%");
                $('#map').css ("transition", "0.4s");
                map.fitBounds(comunaLimite.getBounds());
            });

            $('.op1').on('click', function(){

                base2.remove();
                base3.remove();
                base.addTo(map);
            });

            $('.op2').on('click', function(){

                base.remove();
                base3.remove();
                base2.addTo(map);
            });

            $('.op3').on('click', function(){

                base.remove();
                base2.remove();
                base3.remove();
                base3.addTo(map);
            });



        });

        function getJSONComuna(){
            var salida;
            $.get({
                url: "https://raw.githubusercontent.com/Sud-Austral/mapa_insumos/main/puntos_calor/limites/" + "10307" + ".json", success: function(data, status){
                salida = data;
            }, async: false });

            return JSON.parse(salida);
        }

        var comunaLim = getJSONComuna();

        let obj = comunaLim;
        let nombre_region = obj.features.map((f) => f.properties.NOM_REGION)[0];
        let nombre_provincia = obj.features.map((f) => f.properties.NOM_PROVIN)[0];
        let nombre_comuna = obj.features.map((f) => f.properties.NOM_COMUNA)[0];

        JSONname = ['Antenas_en_Servicio_SSC_COM_CGS', 'APR_SSC_COM_CGS', 'Atractivos_Turisticos_SSC_COM_CGS', 'Compa√±ia_Bomberos_SSC_COM_CGS', 'Contaminantes_SSC_COM_CGS', 'Contrato_Obras_MOP_SSC_COM_CGS', 'Cuartel_carabineros_SSC_COM_CGS', 'Cuerpo_Bomberos_SSC_COM_CGS', 'EIA_Proyectos_SSC_COM_CGS', 'Embalses_SSC_COM_CGS', 'Est_Met_Automa_EMAS_SSC_COM_CGS', 'Establecimiento_Escolar_SSC_COM_CGS', 'Establecimiento_Parvularia_SSC_COM_CGS', 'Establecimiento_Salud_SSC_COM_CGS', 'Estacion_Fluviometrica_SSC_COM_CGS', 'Estacion_Metereologica_SSC_COM_CGS', 'Grifos_SSC_COM_CGS', 'Industria_Forestal_SSC_COM_CGS', 'Museos_SSC_COM_CGS', 'Programas_Proteccion_SENAME_SSC_COM_CGS', 'Puentes_SSC_COM_CGS', 'SEIA_proyectos_aprobados_SSC_COM_CGS', 'Areas_Protegidas_SSC_COM_CGS', 'Bienes_Nac_Proteg_BNP_SSC_COM_CGS', 'Erodabilidad_SSC_COM_CGS', 'Humedales_SSC_COM_CGS', 'Koppen_clima_SSC_COM_CGS', 'Lagos_SSC_COM_CGS', 'Parques_Urbanos_SSC_COM_CGS', 'Pisos_Vegetacionales_SSC_COM_CGS'];
        JSONDisplayName = ['Antenas (Sistemas Radiantes)', 'Agua Potable Rural', 'Atractivos tur√≠sticos', 'Compa√±√≠a de bomberos', 'Contaminantes', 'Ministerio de Obras P√∫blicas', 'Cuarteles Carabineros', 'Cuerpo de Bomberos', 'Estudios de Impacto Ambiental', 'Embalses', 'Estaci√≥n Automa', 'Establecimiento educaci√≥n escolar', 'Establecimiento educaci√≥n parvularia', 'Establecimiento de salud', 'Estaci√≥n fluviom√©trica', 'Estaci√≥n metereol√≥gica', 'Grifos', 'Industria Forestal', 'Museos', 'Protecci√≥n SENAME', 'Puentes', 'Proyectos aprobado SEIA', '√Åreas protegidas', 'Bienes Nacionales Protegido', 'Erodabilidad del suelo', 'Humedales', 'Zonas clim√°ticas de Chile', 'Lagos', 'Parques Urbanos', 'Pisos vegetacionales'];

        for (var i = 0; i < JSONname.length; ++i) {

            function getJSON(){
                var salida;

                $.get({
                    url: "https://raw.githubusercontent.com/Sud-Austral/mapa_insumos/main/comunas_capas/shapes_por_comuna/" + JSONname[i] + "/" + "10307" +".json", success: function(data, status){
                    salida = data;
                }, async: false });

                // Convert STRING to JSON
                var salidaFinal = JSON.parse(salida);

                var filteredFeatures = salidaFinal.features.filter(function(feature) {
                    return feature.properties.COD_COM == '10307'


                })

                return filteredFeatures;

            }

            window[JSONname[i]] = getJSON();

        }

        function getJSONUrbano(){
            var salida;

            $.get({
                url: "https://raw.githubusercontent.com/Sud-Austral/mapa_insumos/main/comunas_capas/shapes_comunas_nacional/Limite_Urbano_SSC_COM_CGS.json", success: function(data, status){
                salida = data;
            }, async: false });

            // Convert STRING to JSON
            var salidaFinal = JSON.parse(salida);

            var filteredFeatures = salidaFinal.features.filter(function(feature) {
                return feature.properties.COD_COM == '10307'
            })

                return filteredFeatures;
        }

        var urbano = getJSONUrbano();

        function getJSONManzanas(){
            var salida;
            $.get({
                url: "https://raw.githubusercontent.com/Sud-Austral/mapa_insumos/main/comunas_capas/comunas_manzanas/" + "10307" + ".json", success: function(data, status){
                salida = data;
            }, async: false });

            return JSON.parse(salida);
        }

        var manzanas = getJSONManzanas();

    </script>

</head>
<body>
    <div id="contenido">
        <div id="sidebar" class="sidebar">
            <div id="container">
                <script>
                    document.write("<span id='general'><b>" + nombre_comuna + "</b></span>")
                </script>
                <br />
                <span id="filtros">Borrar filtros</span>
                <br /><br />
            </div>
            
            <a href="#" class="boton-cerrar" onclick="ocultar()">&times;</a>
            <nav>
                <ul id="categories"></ul>
            </nav>
            <img src="https://github.com/Sud-Austral/mapa_insumos/raw/main/imagenes/blanco-trans.png" alt="Data Intelligence" class="logo" />
        </div>

        <div id="map">
            <div id="menu">
                <ul>
                    <li class="op1">MAPA CLARO</li>
                    <li class="op2">MAPA OSCURO</li>
                    <li class="op3">MAPA SATELITAL</li>
                </ul>
            </div>
        </div>
        <a id="abrir" class="abrir-cerrar" href="javascript:void(0)" onclick="mostrar()">Ver capas</a>


        <script>
        leyendas = [];

        // VARIABLES
        vars = ['TECNOLOGIA', 'COD_COM', 'CATEGORIA', 'COD_COM', 'COD_COM', 'COD_COM', 'COD_COM', 'COD_COM', 'COD_COM', 'TIPO', 'COD_COM', 'COD_COM', 'Industria', 'COD_COM', 'COD_COM', 'COD_COM', 'COD_COM', 'COD_COM', 'COD_COM', 'COD_COM', 'COD_COM', 'COD_COM', 'Designa', 'ANHO_CREAC', 'usos', 'COD_COM', 'Denominaci', 'TIPO', 'ADMINISTRA', 'formacion'];

        colors1 = ['#976996', '#347073', '#897428',	'#635105', '#913848', '#931828', '#444727',	'#394802', '#831245', '#540805', '#501228',	'#119310', '#173156', '#319409', '#512697',	'#508226', '#904745', '#920505', '#976705',	'#297186',	'#906417', '#358501', '#865140', '#475485',	'#161696',	'#216989', '#499309', '#240688', '#372896',	'#574943', '#609586', '#889284', '#567304',	'#592764', '#976996', '#347073', '#897428',	'#635105', '#913848', '#931828', '#444727',	'#394802', '#831245', '#540805', '#501228',	'#119310', '#173156', '#319409', '#512697',	'#508226', '#904745', '#920505', '#976705',	'#297186',	'#906417', '#358501', '#865140', '#475485',	'#161696',	'#216989', '#499309', '#240688', '#372896',	'#574943', '#609586', '#889284', '#567304',	'#592764']

        // Antenas (Sistemas Radiantes)
        title1 = "Antenas (Sistemas Radiantes)";
        fields1 = ['REGION', 'COMUNA', 'ALIAS', 'TISO_DESCR', 'POINT_X', 'POINT_Y'];
        fieldsNames1 = ['REGI√ìN:', 'COMUNA:', 'ALIAS:', 'DESCRIPCI√ìN:', 'LONGITUD:', 'LATITUD:'];

        // Agua Poteble Rural
        title2 = "Agua Poteble Rural";
        fields2 = ['REGION', 'COMUNA', 'NOM_SSUBC', 'LOCALIDAD', 'POINT_X', 'POINT_Y'];
        fieldsNames2 = ['REGI√ìN:', 'COMUNA:', 'NOMBRE SUBCUENCA:', 'LOCALIDAD:', 'LONGITUD:', 'LATITUD:'];

        // Atractivos tur√≠sticos
        title3 = "Atractivos tur√≠sticos";
        fields3 = ['REGION', 'COMUNA', 'SUBTIPO', 'NOMBRE', 'POINT_X', 'POINT_Y'];
        fieldsNames3 = ['REGI√ìN:', 'COMUNA:', 'SUBTIPO:', 'NOMBRE:', 'LONGITUD:', 'LATITUD:'];

        // Compa√±√≠a de bomberos
        title4 = "Compa√±√≠a de bomberos";
        fields4 = ['REGION', 'PROVINCIA', 'COMUNA', 'Compa√±ia', 'POINT_X', 'POINT_Y'];
        fieldsNames4 = ['REGI√ìN:', 'PROVINCIA:', 'COMUNA:', 'COMPA√ë√çA:', 'LONGITUD:', 'LATITUD:'];

        // Contaminantes
        title5 = "Contaminantes";
        fields5 = ['REGION', 'PROVINCIA', 'COMUNA', 'NOM_SSUBC', 'Raz√≥n', 'Nombre', 'Rubro', 'POINT_X', 'POINT_Y'];
        fieldsNames5 = ['REGI√ìN:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE SUBCUENCA:', 'RAZ√ìN:', 'NOMBRE', 'RUBRO:', 'LONGITUD:', 'LATITUD:'];

        // MOP
        title6 = "Contratos MOP";
        fields6 = ['REGION', 'COMUNA', 'POINT_X', 'POINT_Y'];
        fieldsNames6 = ['REGI√ìN:', 'COMUNA:', 'LONGITUD:', 'LATITUD:'];

        // Cuarteles carabineros
        title7 = "Cuarteles carabineros";
        fields7 = ['REGION', 'PROVINCIA', 'COMUNA', 'NOMBRE_UNI', 'TIPO_DE_UN', 'NOMBRE_DE', 'POINT_X', 'POINT_Y'];
        fieldsNames7 = ['REGI√ìN:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE:', 'TIPO:', 'NOMBRE:', 'LONGITUD:', 'LATITUD:'];

        // CUERPO DE BOMBEROS
        title8 = "Cuerpo de Bomberos";
        fields8 = ['REGION', 'PROVINCIA', 'COMUNA', 'Nombre_de', 'POINT_X', 'POINT_Y'];
        fieldsNames8 = ['REGI√ìN:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE:', 'LONGITUD:', 'LATITUD:'];

        // Estudios de Impacto Ambiental
        title9 = "Estudios de Impacto Ambiental";
        fields9 = ['REGION', 'PROVINCIA', 'COMUNA', 'NOM_SSUBC', 'NOMBRE_PRO', 'TITULAR', 'NUEVO_X', 'NUEVO_Y'];
        fieldsNames9 = ['REGI√ìN:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE SUBCUENCA:', 'NOMBRE:', 'TITULAR: ', 'LONGITUD:', 'LATITUD:'];

        // EMBALSES
        title10 = "Embalses";
        fields10 = ['REGION', 'COMUNA', 'NOM_SSUBC', 'NOMBRE', 'POINT_X', 'POINT_Y'];
        fieldsNames10 = ['REGI√ìN:', 'COMUNA:', 'NOMBRE SUBCUENCA:', 'NOMBRE:', 'LONGITUD:', 'LATITUD:'];

        // Est_Met_Automa_EMAS_SSC_COM_CGS
        title11 = "Est_Met_Automa_EMAS_SSC_COM_CGS";
        fields11 = ['REGION', 'COMUNA', 'POINT_X', 'POINT_Y'];
        fieldsNames11 = ['REGI√ìN:', 'COMUNA:', 'LONGITUD:', 'LATITUD:'];

        // ESTABLECIMIENTO ESCOLAR
        title12 = "Establecimiento educaci√≥n escolar";
        fields12 = ['REGION', 'PROVINCIA', 'COMUNA', 'NOM_RBD', 'TIPO_DEPEN', 'POINT_X', 'POINT_Y'];
        fieldsNames12 = ['REGI√ìN:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE RBD:', 'TIPO DE DEPENDENCIA:', 'LONGITUD:', 'LATITUD:'];

        // PARVULARIA
        title13 = "Establecimiento educaci√≥n parvularia";
        fields13 = ['REGION', 'PROVINCIA', 'COMUNA', 'NOM_ESTAB', 'POINT_X', 'POINT_Y'];
        fieldsNames13 = ['REGI√ìN:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE DEL ESTABLECIMIENTO:', 'LONGITUD:', 'LATITUD:'];

        // ESTABLECIMIENTO SALUD
        title14 = "Establecimiento de salud";
        fields14 = ['REGION', 'PROVINCIA', 'COMUNA', 'DEPEN', 'PERENEC', 'TIPO', 'POINT_X', 'POINT_Y'];
        fieldsNames14 = ['REGI√ìN:', 'PROVINCIA:', 'COMUNA:', 'DEPENDENCIA:', 'PERENEC:', 'TIPO:', 'LONGITUD:', 'LATITUD:'];

        // FLUVIOM√âTRICA
        title15 = "Estaci√≥n fluviom√©trica";
        fields15 = ['REGION', 'PROVINCIA', 'COMUNA', 'NOM_SSUBC', 'NOMBRE', 'NOM_CUEN', 'POINT_X', 'POINT_Y'];
        fieldsNames15 = ['REGI√ìN:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE SUBCUENCA:', 'NOMBRE:', 'NOMBRE CUENCA:', 'LONGITUD:', 'LATITUD:'];

        // ESTACI√ìN METEREOL√ìGICA
        title16 = "Estaci√≥n metereol√≥gica";
        fields16 = ['REGION', 'PROVINCIA', 'COMUNA', 'NOM_SSUBC', 'NOMBRE', 'NOM_CUEN', 'POINT_X', 'POINT_Y'];
        fieldsNames16 = ['REGI√≥N:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE SUBCUENCA:', 'NOMBRE:', 'NOMBRE CUENCA:', 'LONGITUD:', 'LATITUD:'];

        // GRIFOS
        title17 = "Grifos";
        fields17 = ['REGION', 'PROVINCIA', 'COMUNA', 'UBICACION', 'MODELO', 'DIAM_GRIFO', 'DIAM_TUB', 'POINT_X', 'POINT_Y'];
        fieldsNames17 = ['REGI√≥N:', 'PROVINCIA:', 'COMUNA:', 'UBICACI√ìN:', 'MODELO:', 'DI√ÅMETRO DEL GRIFO', 'DI√ÅMETRO DEL TUBO', 'LONGITUD:', 'LATITUD:'];

        // INDUSTRIA FORES
        title18 = "Industria Forestal";
        fields18 = ['REGION', 'PROVINCIA', 'COMUNA', 'Industria', 'Movilidad', 'Ciudad', 'Productos', 'Especies', 'POINT_X', 'POINT_Y'];
        fieldsNames18 = ['REGI√ìN:', 'PROVINCIA:', 'COMUNA:', 'INDUSTRIA', 'MOVILIDAD', 'CIUDAD', 'PRODUCTOS', 'ESPECIES', 'LONGITUD:', 'LATITUD:'];

        // Museos
        title19 = "Museos";
        fields19 = ['REGION', 'PROVINCIA', 'COMUNA', 'nombre', 'tipo_inst', 'depend', 'subdepend', 'POINT_X', 'POINT_Y'];
        fieldsNames19 = ['REGI√ìN:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE:', 'TIPO:', 'DEPENDENCIA:', 'SUBDEPENDENCIA:', 'LONGITUD:', 'LATITUD:'];

        // Programas de Protecci√≥n SENAME
        title20 = "Programas de Protecci√≥n SENAME";
        fields20 = ['REGION', 'PROVINCIA', 'COMUNA', 'TipoProyec', 'Modelo_Int', 'NUEVO_X', 'NUEVO_Y'];
        fieldsNames20 = ['REGI√ìN:', 'PROVINCIA:', 'COMUNA:', 'TIPO:', 'MODELO:', 'LONGITUD:', 'LATITUD:'];

        // PUENTES
        title21 = "Puentes";
        fields21 = ['REGION', 'PROVINCIA', 'COMUNA', 'NOM_SSUBC', 'Name', 'POINT_X', 'POINT_Y'];
        fieldsNames21 = ['REGION:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE SUBCUENCA:', 'NOMBRE:', 'LONGITUD:', 'LATITUD:'];

        // Proyectos aprobado SEIA
        title22 = "Proyectos aprobado SEIA";
        fields22 = ['REGION', 'PROVINCIA', 'COMUNA', 'NOM_SSUBC', 'NOMBRE_PRO', 'TITULAR', 'POINT_X', 'POINT_Y'];
        fieldsNames22 = ['REGION:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE SUBCUENCA:', 'NOMBRE:', 'TITULAR:', 'LONGITUD:', 'LATITUD:'];

        // √ÅP
        title23 = "√Åreas Protegidas";
        fields23 = ['REGION', 'PROVINCIA', 'COMUNA', 'Name_AP', 'Ha_AP'];
        fieldsNames23 = ['REGION:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE √ÅREA PROTEIDA:', 'SUPERFICIE (ha):'];

        // BIENES
        title24 = "Bienes Nacionales Protegido";
        fields24 = ['REGION', 'PROVINCIA', 'COMUNA', 'NOM_BNP', 'DECRETO_AF', 'ANHO_CREAC'];
        fieldsNames24 = ['REGION:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE:', 'DECRETO:', 'A√ëO CREACI√ìN:'];

        // ERODABILIDAD
        title25 = "Erodabilidad del suelo";
        fields25 = ['REGION', 'PROVINCIA', 'COMUNA', 'NOM_SSUBC', 'usos', 'Hectareas'];
        fieldsNames25 = ['REGION:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE SUBCUENCA:', 'USOS:', 'SUPERFICIE (ha):'];

        // HUMEDALES
        title26 = "Humedales";
        fields26 = ['REGION', 'PROVINCIA', 'COMUNA', 'NOM_SSUBC', 'Nombre', 'SubClase'];
        fieldsNames26 = ['REGION:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE SUBCUENCA:', 'NOMBRE:', 'SUB CLASE:'];

        // KOPPEN
        title27 = "Zonas clim√°ticas de Chile";
        fields27 = ['REGION', 'PROVINCIA', 'COMUNA', 'Denominaci', 'Hectareas'];
        fieldsNames27 = ['REGION:', 'PROVINCIA:', 'COMUNA:', 'DENOMINACI√ìN:', 'SUPERFICIE (ha):'];

        // LAGOS
        title28 = "Lagos";
        fields28 = ['REGION', 'PROVINCIA', 'COMUNA', 'NOMBRE', 'Hectarea'];
        fieldsNames28 = ['REGION:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE:', 'SUPERFICIE (ha):'];

        // PARQUES URBANOS
        title29 = "Parques Urbanos";
        fields29 = ['REGION', 'PROVINCIA', 'COMUNA', 'NOMBRE', 'ADMINISTRA', 'SUMINISTRO'];
        fieldsNames29 = ['REGION:', 'PROVINCIA:', 'COMUNA:', 'NOMBRE:', 'ADMINISTRACI√ìN:', 'SUMINISTRO:'];

        // PISOS VEGETACIONALES
        title30 = "Pisos vegetacionales";
        fields30 = ['REGION', 'PROVINCIA', 'COMUNA', 'piso', 'formacion'];
        fieldsNames30 = ['REGION:', 'PROVINCIA:', 'COMUNA:', 'PISO:', 'FORMACI√ìN:'];


         // initialize the map
         var map = L.map('map').setView([-33.458725187656356, -70.66008634501547], 4);

        // MAPA BASE 1
        var base = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
                'Imagery ¬© <a href="https://www.mapbox.com/">Mapbox</a>',
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1
        }).addTo(map);

        // MAPA BASE 2
        var base2 = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
                'Imagery ¬© <a href="https://www.mapbox.com/">Mapbox</a>',
            id: 'mapbox/dark-v9',
            tileSize: 512,
            zoomOffset: -1
        });

        // MAPA BASE 3
        var base3 = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
                'Imagery ¬© <a href="https://www.mapbox.com/">Mapbox</a>',
            id: 'mapbox/satellite-streets-v9',
            tileSize: 512,
            zoomOffset: -1
        });

        function styleComuna(feature) {
             return {
                weight: 1.3, // Grosor de l√≠nea
                color: '#3d3d3d', // Color de l√≠nea
                opacity: 1, // Transparencia de l√≠nea
                fillColor: '#FFF', // Color de relleno
                fillOpacity: 0.2 // Transparencia de relleno
            };
        };

        var comunaLimite = L.geoJson(comunaLim, { style: styleComuna}).addTo(map);
        map.fitBounds(comunaLimite.getBounds());

        // URBANO
        function styleUrbano(feature) {
             return {
                weight: 1.3, // Grosor de l√≠nea
                color: '#3d3d3d', // Color de l√≠nea
                opacity: 1, // Transparencia de l√≠nea
                fillColor: '#FFF', // Color de relleno
                fillOpacity: 0.2 // Transparencia de relleno
            };
        };

        var urbanoLimite = L.geoJson(urbano, { style: styleUrbano});

        // MANZANAS
        function styleManzana(feature) {
             return {
                weight: 1.3, // Grosor de l√≠nea
                color: '#3d3d3d', // Color de l√≠nea
                opacity: 1, // Transparencia de l√≠nea
                fillColor: '#FFF', // Color de relleno
                fillOpacity: 0.2 // Transparencia de relleno
            };
        };

        var manzanaLimite = L.geoJson(manzanas, { style: styleManzana});

        // GET COLORS
        function getColor(d, parametro) {

            for (var i = 0; i < parametro.length; ++i) {

                for (var j = 0; j < vars.length; ++j) {


                    if(d[vars[j]] == parametro[i]){
                        return colors1[i]
                    }
                }

            }

        }

        for (var i = 0; i < JSONname.length; ++i) {

            var comuna = window[JSONname[i]];
            var name = JSONDisplayName[i];
            var nameCate = JSONname[i];

            eachTitle = 'title' + parseInt(i + 1);
            campos = 'fields' + parseInt(i + 1);
            camposNombre = 'fieldsNames' + parseInt(i + 1);

            category = vars[i]
            var legendName = 'legends' + i

            if(comuna.length > 0){
                leyendas.push(i);

                const categories = [...new Set(window[nameCate].map(b => b.properties[category]))]

                function popup(feature, layer) {

                    _title = '<center><b><h2>' + window[eachTitle] + '</h2></b></center>';
                    information = '';
                    logo = "<br><center><img class='banner' src='https://raw.githubusercontent.com/Sud-Austral/mapa_glaciares/main/img/logo_DataIntelligence_normal.png' alt='Data Intelligence'/></center>";

                    for (var i = 0; i < window[campos].length; ++i) {

                        information += "<b>" + window[camposNombre][i] + "</b> " + feature.properties[window[campos][i]] + "<br>"

                        layer.bindPopup(
                            _title + information + logo

                        );
                    }
                }

                window[name] = L.geoJson(comuna, {style: function(feature) {
                        return {
                            weight: 2, // Grosor de l√≠nea
                            color: 'tranparent', // Color de l√≠nea
                            opacity: 1.0, // Transparencia de l√≠nea
                            fillColor: getColor(feature.properties, categories),
                            fillOpacity: 1 // Transparencia de relleno
                        };
                    } , pointToLayer: function (feature, latlng) {
                    return new L.CircleMarker(latlng, {
                        radius: 6,
                        fillOpacity: 1
                    })
                }, onEachFeature: popup});
                
                // console.log(name);

                window[legendName] = L.control({ position: 'bottomleft' });

            }
       }

        function deleteLegends(){
            for (var i = 0; i < JSONname.length; ++i) {
                var comuna = window[JSONname[i]];
                
                deleteLayerName = 'legends' + i;

                if(comuna.length > 0){

                    window[deleteLayerName].remove();
                }
            }
        }

        var estado = 0;

        function getLegend(i){

            if(estado == 0){
                estado = 1;
            }else if(estado == 1){
                estado = 0;
            }

            console.log(estado);

            var comuna = window[JSONname[i]];
            var name = JSONname[i];
            var nameCate = JSONname[i];

            eachTitle = 'title' + parseInt(i + 1);
            campos = 'fields' + parseInt(i + 1);
            camposNombre = 'fieldsNames' + parseInt(i + 1);

            category = vars[i]
            var legendName = 'legends' + i

            var name2 = JSONDisplayName[i];
            desactivarCasillas();
            deleteLegends();
            deleteAllLayer();

            window[name2].addTo(map);

            
                if(comuna.length > 0){

                    const categories = [...new Set(window[nameCate].map(b => b.properties[category]))]

                    window[legendName] = L.control({ position: 'bottomright' });

                    var legendFields = "";

                    for (var j = 0; j < categories.length; ++j) {

                        if(categories[j] == '10307'){
                            legendFields += "<span class='desc' style='background: " + colors1[j] + ";'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> " + window[eachTitle] + "<br>";
                        }else{
                            if(categories[j] == ''){
                                legendFields += "<span class='desc' style='background: " + colors1[j] + ";'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> Sin informaci√≥n<br>";
                            }else{
                                legendFields += "<span class='desc' style='background: " + colors1[j] + ";'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> " +  categories[j] + "<br>";
                            }
                        }


                    }
                
                    // console.log('NOMBRE CAPA: ' + legendName);

                    window[legendName].onAdd = function () {
                        var div = L.DomUtil.create('div', 'legend');

                        div.innerHTML +=
                        '<div>' +
                        '<p class="titleLegend"><b>' + window[eachTitle] + '</b></p>' +
                        legendFields +
                        '</div>';

                        return div;
                    };
                    // leyendas.push(JSON.parse(JSON.stringify(window[legendName])));

                    window[legendName].addTo(map);
                }

        }



        // NEW LAYER CODE

        var overlayMaps2 = {
            "L√≠mite Municipal": comunaLimite,
            "L√≠mite Urbano": urbanoLimite,
            "L√≠mite Manzaneros Urbanos": manzanaLimite,
        };

        var capas2 = {

        };

        L.control.layers(capas2, overlayMaps2, {
            position: 'topright', // 'topleft', 'bottomleft', 'bottomright'
            collapsed: false // true
        }).addTo(map);

       function mostarLeyenda(legend){
            /*for (var i = 0; i < (leyendas.length); ++i) {
                eval('legends' + leyendas[i] + '.remove()');
            }

            let codigo = parseInt(legend.replace('funcionLeyenda', ''));*/

            let capaID = getId(legend);
            // console.log(legend);
            console.log(capaID);
            getLegend(capaID);
        }

        function deleteEachLayer(legend){

            let capaID = getId(legend);
            // console.log('ID: ' + capaID);
            var layerToDelete = JSONDisplayName[capaID];

            // console.log(layerToDelete);

            window[layerToDelete].remove();


        }

        function deleteAllLayer(){

            for (var i = 0; i < JSONname.length; ++i) {

                var comuna = window[JSONname[i]];
                var name = JSONDisplayName[i];

                if(comuna.length > 0){

                    window[name].remove();
                }
            }
        }

        var capas = document.getElementsByClassName('leaflet-control-layers-selector');

        for (var i = 0; i < (capas.length - 3); ++i) {


            $(capas[i]).addClass('funcionLeyenda' + i);

            $(capas[i]).on('click', function(){
                // alert($(this).attr('class').replaceAll('leaflet-control-layers-selector ', ''));
                console.log($(this).attr('class').replaceAll('leaflet-control-layers-selector ', ''));
                mostarLeyenda($(this).attr('class').replaceAll('leaflet-control-layers-selector ', ''));


            });

        }

        </script>
    </div>
    <script>
        function mostrar() {
            document.getElementById("sidebar").style.width = "18%";
            document.getElementById("contenido").style.marginLeft = "18%";
            document.getElementById("abrir").style.display = "none";
            // document.getElementById("cerrar").style.display = "inline";
        }

        function ocultar() {
            document.getElementById("sidebar").style.width = "0";
            document.getElementById("contenido").style.marginLeft = "0";
            document.getElementById("abrir").style.display = "inline";
            // document.getElementById("cerrar").style.display = "none";
        }

        var cates = ['Agua', 'Clima y Atm√≥sfera', 'Educaci√≥n', 'Flora y Fauna', 'Instalaciones y Edificaciones', 'Medio Ambiente', 'Planificaci√≥n y catastro', 'Energ√≠a y servicios b√°sicos', 'Salud', 'Sociedad', 'Transporte', 'Turismo'];

        var agua = [];
        var climaAtmos = [];
        var edu = [];
        var floraFau = [];
        var instalaEdificac = [];
        var ambiente = [];
        var planiCatas = [];
        var redes = [];
        var salud = [];
        var sociedad = [];
        var transp = [];
        var turismo = [];

        var nombeGrupos = ['agua', 'climaAtmos', 'edu', 'floraFau', 'instalaEdificac', 'ambiente', 'planiCatas', 'redes', 'salud', 'sociedad', 'transp', 'turismo'];

        for (var i = 0; i < JSONname.length; ++i) {
            

            var comuna = window[JSONname[i]];
           
            if(comuna.length > 0){

                subcate = JSONDisplayName[i];

                switch(subcate) {
                    
                    case 'Lagos':
                        agua.push(subcate);
                    break;

                    case 'Estaci√≥n fluviom√©trica':
                        climaAtmos.push(subcate);
                    break;

                    case 'Estaci√≥n metereol√≥gica':
                        climaAtmos.push(subcate);
                    break;
                    
                    case 'Establecimiento educaci√≥n escolar':
                        edu.push(subcate);
                    break;
                
                    case 'Establecimiento educaci√≥n parvularia':
                        edu.push(subcate);
                    break;

                    case 'Catastro de uso de suelo':
                        floraFau.push(subcate);
                    break;
                    
                    case 'Uso de suelo':
                        floraFau.push(subcate);
                    break;
                    
                    case 'Industria Forestal':
                        instalaEdificac.push(subcate);
                    break;

                    case 'Cuerpo de Bomberos':
                        instalaEdificac.push(subcate);
                    break;

                    case 'Compa√±√≠a de bomberos':
                        instalaEdificac.push(subcate);
                    break;

                    case 'Cuarteles carabineros':
                        instalaEdificac.push(subcate);
                    break;

                    case 'Museos':
                        instalaEdificac.push(subcate);
                    break;

                    case 'Embalses':
                        ambiente.push(subcate);
                    break;

                    case 'Erodabilidad del suelo':
                        ambiente.push(subcate);
                    break;

                    case 'Humedales':
                        ambiente.push(subcate);
                    break;

                    case 'Pisos vegetacionales':
                        ambiente.push(subcate);
                    break;

                    case '√Åreas protegidas':
                        ambiente.push(subcate);
                    break;

                    case 'Bienes Nacionales Protegidos':
                        ambiente.push(subcate);
                    break;

                    case 'Contaminantes':
                        ambiente.push(subcate);
                    break;

                    case 'Zonas clim√°ticas de Chile':
                        ambiente.push(subcate);
                    break;

                    case 'Estudios de Impacto Ambiental':
                        ambiente.push(subcate);
                    break;

                    case 'Proyectos aprobado SEIA':
                        ambiente.push(subcate);
                    break;

                    case 'Plan Regulador comunal':
                        planiCatas.push(subcate);
                    break;

                    case 'Parques Urbanos':
                        planiCatas.push(subcate);
                    break;
                    
                    case 'Antenas (Sistemas Radiantes)':
                        redes.push(subcate);
                    break;

                    case 'Agua Potable Rural':
                        redes.push(subcate);
                    break;

                    case 'Establecimiento de salud':
                        salud.push(subcate);
                    break;

                    case 'Grifos':
                        sociedad.push(subcate);
                    break;

                    case 'Microdatos censo poblaci√≥n y vivienda':
                        sociedad.push(subcate);
                    break;

                    case 'Protecci√≥n SENAME':
                        sociedad.push(subcate);
                    break;

                    case 'Puentes':
                        transp.push(subcate);
                    break;

                    case 'Red vial':
                        transp.push(subcate);
                    break;
                    
                    case 'Atractivos tur√≠sticos':
                        turismo.push(subcate);
                    break;

                  default:
                    console.log('');
                }

            }
        }

        function getId(subcate){
            switch(subcate) {
                    
                case 'Lagos':
                    return 27;
                break;

                case 'Estaci√≥n fluviom√©trica':
                    return 14;
                break;

                case 'Estaci√≥n metereol√≥gica':
                    return 15;
                break;
                    
                case 'Establecimiento educaci√≥n escolar':
                    return 11;
                break;
                
                case 'Establecimiento educaci√≥n parvularia':
                    return 12;
                break;
                    
                case 'Industria Forestal':
                    return 17;
                break;

                case 'Cuerpo de Bomberos':
                    return 7;
                break;

                case 'Compa√±√≠a de bomberos':
                    return 3;
                break;

                case 'Cuarteles carabineros':
                    return 6;
                break;

                case 'Museos':
                    return 18;
                break;

                case 'Embalses':
                    return 9;
                break;

                case 'Erodabilidad del suelo':
                    return 24;
                break;

                case 'Humedales':
                    return 25;
                break;

                case 'Pisos vegetacionales':
                    return 29;
                break;

                case '√Åreas protegidas':
                    return 22;
                break;

                case 'Bienes Nacionales Protegidos':
                    return 23;
                break;

                case 'Contaminantes':
                    return 4;
                break;

                case 'Zonas clim√°ticas de Chile':
                    return 26;
                break;

                case 'Estudios de Impacto Ambiental':
                    return 8;
                break;

                case 'Proyectos aprobado SEIA':
                    return 21;
                break;

                case 'Parques Urbanos':
                    return 28;
                break;
                    
                case 'Antenas (Sistemas Radiantes)':
                    return 0;
                break;

                case 'Agua Potable Rural':
                    return 1;
                break;

                case 'Establecimiento de salud':
                    return 13;
                break;

                case 'Grifos':
                    return 16;
                break;

                case 'Protecci√≥n SENAME':
                    return 19;
                break;

                case 'Puentes':
                    return 20;
                break;

                case 'Atractivos tur√≠sticos':
                    return 2;
                break;

                case 'Ministerio de Obras P√∫blicas':
                    return 5;
                break;

                case 'Estaci√≥n Automa':
                    return 10;
                break;

                default:
                console.log('');
            }
        }


        for (var i = 0; i < nombeGrupos.length; ++i) {

            var group = window[nombeGrupos[i]];

            if(group.length > 0){
                var option = 'option' + i;
                // console.log(nombeGrupos[i]);
                // console.log(window[nombeGrupos[i]]);

                $("div#container").append(function(){
                    return "<button class='accordion'><b>‚Ä¢</b> " + cates[i] + "</button><div class='accordion-content' style=''><ul id='menucate" + i + "'></ul></div>";
        	    });
            
                for (var j = 0; j < window[nombeGrupos[i]].length; ++j) {
                    // console.log(window[nombeGrupos[i]][j]);
                    
                    var finalOption = option + "_" + j;

                    var nivelCate = "ul#subcate" + i;
                    var nivelCategories = "ul#menucate" + i;

                    // console.log(nivelCategories);

                    // console.log(nivelCate);


                    $(nivelCategories).append(function(){
            	        // return "<li class='itemLateral funcionLeyenda" + i + "'><input type='checkbox' id='" + finalOption + "'> <label for='" + finalOption + "'>" + window[nombeGrupos[i]][j] + "</label></li>";
                        return "<li ><input type='radio' id='" + finalOption + "'> <label class='itemLateral " + window[nombeGrupos[i]][j] + "' for='" + finalOption + "'>" + window[nombeGrupos[i]][j] + "</label></li>";
        	        });
                }

            }
        }
        
        var capas2 = document.getElementsByClassName('itemLateral');

        for (var i = 0; i < (capas2.length); ++i) {


            $(capas2[i]).on('click', function(){
                // console.log($(this).attr('class').replaceAll('itemLateral ', ''));
                mostarLeyenda($(this).attr('class').replaceAll('itemLateral ', ''));
                
            });

        }

        var accordions = document.getElementsByClassName("accordion");

        for (var i = 0; i < accordions.length; i++) {
            

            accordions[i].onclick = function() {
            cerrarOpen();

            this.classList.toggle('is-open');

            var content = this.nextElementSibling;
            if (content.style.maxHeight) {
              // accordion is currently open, so close it
              content.style.maxHeight = null;
            } else {
              // accordion is currently closed, so open it
              content.style.maxHeight = content.scrollHeight + "px";
            }
          }
        }
        
        function cerrarOpen(){
            var isOpen = document.getElementsByClassName("is-open");

            for (var i = 0; i < isOpen.length; i++) {
                var content = isOpen[i].nextElementSibling;
                isOpen[i].classList.toggle('is-open');
                content.style.maxHeight = null;
            }
        }
        
       function desactivarCasillas(){
            miscasillas=document.getElementsByTagName('input'); //Rescatamos controles tipo Input
	        for(i=0;i<miscasillas.length;i++) //Ejecutamos y recorremos los controles
	        {
		        if(miscasillas[i].type == "radio") // Ejecutamos si es una casilla de verificacion
		        {
			        miscasillas[i].checked = false;
		        }
	        }
       }

        $('#filtros').on('click', function(){
            desactivarCasillas();
            cerrarOpen();
            deleteLegends();
            deleteAllLayer();
        });
    </script>
</body>
</html>